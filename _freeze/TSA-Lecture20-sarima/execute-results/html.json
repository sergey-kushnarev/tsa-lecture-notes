{
  "hash": "41039c7958a5fe77dd2049cc24caba82",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"439/639: SARIMA = Seasonal ARIMA\"\nauthor: \"Dr Sergey Kushnarev\"\nformat:\n  html:\n    toc: true\n    number-sections: true\n    code-fold: true\n---\n\n\n\n\nThis notebook is based on Chapter 10 of Cryer and Chan, \"Time Series Analysis: With Applications in R\".\n\n# Monthly Carbon Dioxide Levels at Alert, NWT, Canada\n\n## Model specification\n\nThe figure below displays the monthly carbon dioxide levels at Alert, NWT, Canada. The data is available in the `TSA` package in R. The data is plotted from January 1994 to December 2004. The points are colored according to the month of the year.\n\nSeasonality is more noticable in the second plot, where we colored and labeled the points according to the month of the year. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(TSA)\ndata(co2)\nplot(co2,ylab='CO2', \n    main='Monthly Carbon Dioxide Levels at Alert, NWT, Canada')\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# The points are colored according to the month of the year\n\n# Define colors for each month (12 distinct colors)\nmonth_colors <- c(\"red\", \"orange\", \"yellow\", \"green\", \"cyan\", \n                  \"blue\", \"purple\", \"magenta\", \"brown\", \"gray\", \n                  \"black\", \"pink\")\nplot(window(co2,start=c(2000,1)),\n    ylab='CO2', \n    main ='Monthly Carbon Dioxide Levels at Alert, NWT, Canada')\nMonth=c('J','F','M','A','M','J','J','A','S','O','N','D')\npoints(window(co2,start=c(2000,1)),\n    pch=Month, col = month_colors[cycle(co2)])\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-1-2.png){width=672}\n:::\n\n```{.r .cell-code}\nacf(as.vector(co2),lag.max=36, \n    main = 'Sample ACF of Yt',\n    xaxp=c(0,36,18))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-1-3.png){width=672}\n:::\n:::\n\n\n\n\nThe sample autocorrelation shows clear signs of seasonality. \n\nWe see a noticeable linear trend in the $Y_t$ plot, indicating that the data is not stationary. We difference once, $\\nabla Y_t$, and plot the differenced series as well as the corresponding sample ACF.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(diff(co2),\n     ylab='First Difference of CO2',\n     xlab='Time',\n     main = expression(nabla * Y[t]))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nacf(as.vector(diff(co2)),\n    lag.max=36,\n    ci.type='ma',\n    xaxp=c(0,36,18),\n    main = expression(\"Sample ACF of \" * nabla * Y[t]))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n:::\n\n\n\n\nThe general upward trend disappears after the first difference. The ACF of the first difference shows a clear seasonal pattern, with peaks at lags 12, 24, and 36. Perhaps seasonal differencing\nwill bring us to a series that may be modeled parsimoniously. We difference it again at lag 12.\n\nNow we are plotting $\\nabla_{12}\\nabla Y_t$ and the corresponding ACF. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(diff(diff(co2),lag=12), xlab='Time',\n    ylab='First and Seasonal Difference of CO2', \n    main = expression( nabla[12] * nabla * Y[t]))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nacf(as.vector(diff(diff(co2),lag=12)),lag.max=36,\n    ci.type='ma',xaxp=c(0,36,18), \n    main = expression(\"Sample ACF of \" * nabla[12] * nabla * Y[t]))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\npacf(as.vector(diff(diff(co2),lag=12)),lag.max=36,\n    xaxp=c(0,36,18), \n    main = expression(\"Sample PACF of \" * nabla[12] * nabla * Y[t]))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-3-3.png){width=672}\n:::\n:::\n\n\n\n\nWe see significant spikes at lags 1, 12 and 13. We can  model this parsimoniously as $MA(1)\\times MA(1)_{12}$. So the original series follows ARIMA$(0,1,1)\\times (0,1,1)_{12}$, i.e.\n\n$$\n\\nabla_{12}\\nabla Y_t = e_t-\\theta e_{t-1} - \\Theta e_{t-12} + \\theta\\Theta e_{t-13}.\n$$\n\n## Fitting and Diagnosing the Model\n\nFitting the model we get the following estimates of the parameters:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1.co2 <- arima(co2,order=c(0,1,1),\n                seasonal=list(order=c(0,1,1),\n                period=12))\nm1.co2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\narima(x = co2, order = c(0, 1, 1), seasonal = list(order = c(0, 1, 1), period = 12))\n\nCoefficients:\n          ma1     sma1\n      -0.5792  -0.8206\ns.e.   0.0791   0.1137\n\nsigma^2 estimated as 0.5446:  log likelihood = -139.54,  aic = 283.08\n```\n\n\n:::\n:::\n\n\n\n\nThe coefficients are highly significant. We check the residuals of the model. Other than some strange behavior in the middle of the series, this plot does not suggest\nany major irregularities with the model\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(window(rstandard(m1.co2),start=c(1995,2)),\n    ylab='Standardized Residuals',\n    type='o', \n         main = expression(\"Residuals from the ARIMA\" ~\n                       \"(\" * 0 * \",\" * 1 * \",\" * 1 * \")\" ~\n                       \"\\u00d7\" ~\n                       \"(\" * 0 * \",\" * 1 * \",\" * 1 * \")\"[12] ~\n                       \"Model\"))\nabline(h=0)\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\nTo diagnose further, we plot the sample ACF of the residuals. The\nonly ``statistically significant'' correlation is at lag 22, and this correlation has a value of\nonly −0.17, a very small correlation. Furthermore, we can't think of any reasonable interpretation\nfor dependence at lag 22. Finally, we should not be surprised that one autocorrelation\nout of the 36 displayed is statistically significant. This could easily happen by\nchance alone. Except for marginal significance at lag 22, the model seems to have captured\nthe essence of the dependence in the series. The Ljing-Box test for the residuals confirms that the residuals are uncorrelated. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nacf(as.vector(window(rstandard(m1.co2),start=c(1995,2))),\nlag.max=36, main = 'Sample ACF of Residuals',\nxaxp=c(0,36,18))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\nBox.test(window(rstandard(m1.co2),start=c(1995,2)),lag=24,type='Ljung-Box')\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tBox-Ljung test\n\ndata:  window(rstandard(m1.co2), start = c(1995, 2))\nX-squared = 25.587, df = 24, p-value = 0.3745\n```\n\n\n:::\n:::\n\n\n\n\nThe histogram, the QQ-plot and the Shapiro-Wilk test for normality of the residuals show that the residuals are nornally distributed. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(window(rstandard(m1.co2),start=c(1995,2)),\nxlab='Standardized Residuals', main = 'Histogram of Residuals')\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nqqnorm(window(rstandard(m1.co2),start=c(1995,2)), main = 'QQ-Plot of Residuals')\nqqline(window(rstandard(m1.co2),start=c(1995,2)))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n\n```{.r .cell-code}\nshapiro.test(window(rstandard(m1.co2),start=c(1995,2)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  window(rstandard(m1.co2), start = c(1995, 2))\nW = 0.98205, p-value = 0.1134\n```\n\n\n:::\n:::\n\n\n\n\nAs one additional check, we overfit the model with ARIMA$(0,1,2)\\times(0,1,1)_{12}$. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm2.co2 <- arima(co2,order=c(0,1,2),seasonal=list(order=c(0,1,1),\nperiod=12))\nm2.co2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\narima(x = co2, order = c(0, 1, 2), seasonal = list(order = c(0, 1, 1), period = 12))\n\nCoefficients:\n          ma1      ma2     sma1\n      -0.5714  -0.0165  -0.8274\ns.e.   0.0897   0.0948   0.1224\n\nsigma^2 estimated as 0.5427:  log likelihood = -139.52,  aic = 285.05\n```\n\n\n:::\n:::\n\n\n\n\nThe AIC increased and the new estimated term $\\theta_2$ is not significant, while the other estimated terms have not changed much. \n\nThe ARIMA$(0,1,1)\\times(0,1,1)_{12}$ model was popularized in the first edition of the seminal\nbook of Box and Jenkins (1976) when it was found to characterize the logarithms of a monthly airline passenger time series. This model has come to be known as the **airline model**. \n\n## Forecasting\n\nThe first plot shows the forecasts and 95% forecast\nlimits for a lead time of two years for the ARIMA$(0,1,1)\\times (0,1,1)_{12}$ model that we fit.\nThe last two years of observed data are also shown. The forecasts mimic the stochastic\nperiodicity in the data quite well, and the forecast limits give a good feeling for the precision.\n\nThe second plot displays the last year of observed data and forecasts out four years.\nAt this lead time, it is easy to see that the forecast limits are getting wider, as there is\nmore uncertainty in the forecasts.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(m1.co2,n1=c(2003,1),n.ahead=24,\n    xlab='Year',type='o',ylab='CO2 Levels', \n    main = 'Forecasts from the ARIMA(0,1,1)×(0,1,1)12 Model, Lead Time=2 Years')\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(m1.co2,n1=c(2004,1),n.ahead=48,\n    xlab='Year',type='b', ylab='CO2 Levels', \n    main = 'Forecasts from the ARIMA(0,1,1)×(0,1,1)12 Model, Lead Time=4 Years')\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture20-sarima_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n:::\n\n\n\n\n## Summary  \n\nMultiplicative seasonal ARIMA models provide an efficient way to model time\nseries whose seasonal tendencies are not as regular as we would have with a deterministic\nseasonal trend model which we covered earlier. Fortunately, these models are\nsimply special ARIMA models so that no new theory is needed to investigate their properties.\nWe illustrated the special nature of these models with a thorough modeling of an\nactual time series of CO2 data.",
    "supporting": [
      "TSA-Lecture20-sarima_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}