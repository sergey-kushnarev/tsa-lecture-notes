{
  "hash": "79bc2be75a1004b2e6148ec7d649092c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R notebook: Model Specification\"\nauthor: \"Dr Sergey Kushnarev\"\nformat:\n  html:\n    toc: true\n    number-sections: true\n    code-fold: true\n---\n\n\n\n\n## Steps in Time Series Analysis            \n\n|   |   |   |   |\n|:---:|:---:|:---:|:---:|\n| **Step 1: Model Specification** |  Step 2: Parameter Estimation  | Step 3: Model Checking | Step 4: Forecasting |\n\n# Model Specification\n\nThis R notebook is based on Chapter 6, Cryer and Chan (2008), *Time Series Analysis with Applications in R*. Springer.\n\nWe have developed a large class of parametric models for both stationary and nonstationary\ntime series -- the ARIMA models. We now begin our study and implementation\nof statistical inference for such models. The subjects of the next three chapters, respectively,\nare:\n\n1. How to choose  $p, d$, and $q$ for a given series? (Chapter 6);\n2. How to estimate $\\phi_i,\\theta_j$ for a specific ARIMA(p,d,q)? (Chapter 7);\n3. Does the model fit well? (Chapter 8).\n4. Forecast the future. (Chapter 9).\n\nOur overall strategy will first be to decide on reasonable preliminary values\nfor $p$, $d$, and $q$ (this notebook). \n\nWe will fit a model to the data (Chapter 7) and then check the residuals for\nautocorrelation and normality (Chapter 8). If the residuals are not white noise, we will try to \nimprove the model by changing the values of $p$, $d$, and $q$.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(TSA)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'TSA' was built under R version 4.4.2\n```\n\n\n:::\n:::\n\n\n\n\n## Specification of simulated MA(q) processes\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the data\ndata(ma1.1.s)\n# ACF of the series\nacf(ma1.1.s,\n    xaxp=c(0,20,10),\n    main = \"ACF of MA(1) with theta=0.9\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nacf(ma1.1.s,\n    ci.type='ma',\n    xaxp=c(0,20,10),\n    main = \"Alternative bounds for the ACF of MA(1) with theta=0.9\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(ma1.2.s)\nacf(ma1.2.s,\n    xaxp=c(0,20,10),\n    main = \"ACF of MA(1) with theta=-0.9\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndata(ma2.s)\nacf(ma2.s,\n    xaxp=c(0,20,10),\n    main = \"ACF of MA(2) with theta1=1, theta2=-0.6\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\nacf(ma2.s,\n    ci.type='ma',\n    xaxp=c(0,20,10),\n    main = \"Alternative bounds for the ACF of MA(2) with theta1=1, theta2=-0.6\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n:::\n\n\n\n\n## Specification of the simulated AR(p) processes\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(ar1.s) \nacf(ar1.s,\n    xaxp=c(0,20,10),\n    main = \"ACF of AR(1) with phi=0.9\") \n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\npacf(ar1.s,xaxp=c(0,20,10),\n      main = \"PACF of AR(1) with phi=0.9\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(ar2.s)\nacf(ar2.s,\n    xaxp=c(0,20,10),\n    main = \"ACF of AR(2) with phi1=1.5, phi2=-0.75\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\npacf(ar2.s,\n     xaxp=c(0,20,10),\n     main = \"PACF of AR(2) with phi1=1.5, phi2=-0.75\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\n\n\n## Specification of the simulated ARMA(p,q) processes\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(arma11.s)\nplot(arma11.s, type='o',ylab=expression(Y[t]),\n    main = \"ARMA(1,1) with phi=0.6, theta=-0.3\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nacf(arma11.s,xaxp=c(0,20,10),\n    main = \"ACF of ARMA(1,1) with phi=0.6, theta=-0.3\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n\n```{.r .cell-code}\npacf(arma11.s,xaxp=c(0,20,10),\n     main = \"PACF of ARMA(1,1) with phi=0.6, theta=-0.3\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-7-3.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# In an R Notebook, simply run this code chunk:\n\n# 1) Create an empty matrix filled with \"X\":\nn_ar <- 8   # AR orders from 0 to 7\nn_ma <- 14  # MA orders from 0 to 13\neacf_mat <- matrix(\"X\", nrow = n_ar, ncol = n_ma)\n\n# 2) Fill with \"0\" below the main diagonal:\n#    For AR>0, columns at or past that AR index become \"0\".\nfor (i in 2:n_ar) {                  # i=2 means AR=1, i=3 means AR=2, etc.\n  for (j in i:n_ma) {                # j runs from \"i\" through 14\n    eacf_mat[i, j] <- \"0\"\n  }\n}\n\n# 3) Put the special \"0*\" mark (the star at AR=1, MA=0):\neacf_mat[2, 2] <- \"0*\"\n\n# 4) Label rows and columns:\nrownames(eacf_mat) <- paste0(\"AR=\", 0:(n_ar-1))\ncolnames(eacf_mat) <- paste0(\"MA=\", 0:(n_ma-1))\n\n# 5) Display the table nicely (using knitr::kable or similar):\nlibrary(knitr)\nkable(eacf_mat, align = \"c\", caption = \"Theoretical EACF for ARMA(1,1)\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Theoretical EACF for ARMA(1,1)\n\n|     | MA=0 | MA=1 | MA=2 | MA=3 | MA=4 | MA=5 | MA=6 | MA=7 | MA=8 | MA=9 | MA=10 | MA=11 | MA=12 | MA=13 |\n|:----|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:-----:|:-----:|:-----:|:-----:|\n|AR=0 |  X   |  X   |  X   |  X   |  X   |  X   |  X   |  X   |  X   |  X   |   X   |   X   |   X   |   X   |\n|AR=1 |  X   |  0*  |  0   |  0   |  0   |  0   |  0   |  0   |  0   |  0   |   0   |   0   |   0   |   0   |\n|AR=2 |  X   |  X   |  0   |  0   |  0   |  0   |  0   |  0   |  0   |  0   |   0   |   0   |   0   |   0   |\n|AR=3 |  X   |  X   |  X   |  0   |  0   |  0   |  0   |  0   |  0   |  0   |   0   |   0   |   0   |   0   |\n|AR=4 |  X   |  X   |  X   |  X   |  0   |  0   |  0   |  0   |  0   |  0   |   0   |   0   |   0   |   0   |\n|AR=5 |  X   |  X   |  X   |  X   |  X   |  0   |  0   |  0   |  0   |  0   |   0   |   0   |   0   |   0   |\n|AR=6 |  X   |  X   |  X   |  X   |  X   |  X   |  0   |  0   |  0   |  0   |   0   |   0   |   0   |   0   |\n|AR=7 |  X   |  X   |  X   |  X   |  X   |  X   |  X   |  0   |  0   |  0   |   0   |   0   |   0   |   0   |\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute EACF\neacf(arma11.s)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAR/MA\n  0 1 2 3 4 5 6 7 8 9 10 11 12 13\n0 x x x x o o o o o o o  o  o  o \n1 x o o o o o o o o o o  o  o  o \n2 x o o o o o o o o o o  o  o  o \n3 x x o o o o o o o o o  o  o  o \n4 x o x o o o o o o o o  o  o  o \n5 x o o o o o o o o o o  o  o  o \n6 x o o o x o o o o o o  o  o  o \n7 x o o o x o o o o o o  o  o  o \n```\n\n\n:::\n:::\n\n\n\n\n## Nonstationarity\n\n\n\n\n\n## Overdifferencing\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Differencing the random walk twice\nz <- rnorm(60)\nrw <- ts(cumsum(z))\nplot(diff(diff(rw)))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# ACF and PACF of the twice-differenced series\nacf(diff(diff(rw)), \n    xaxp=c(0,22,11),\n    ci.type='ma',\n    main=\"Sample ACF of the overdifferenced random walk\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n\n```{.r .cell-code}\nacf(diff(rw), \n    xaxp=c(0,22,11),\n    main=\"Sample ACF of the correctly differenced random walk\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-10-3.png){width=672}\n:::\n:::\n\n\n\n\n## Detecting nonstationarity: Augmented Dickey-Fuller test\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Augmented Dickey-Fuller test\n# Unit root test of the random walk and its first difference\nlibrary(tseries)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n```\n\n\n:::\n\n```{.r .cell-code}\nadf.test(rw)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAugmented Dickey-Fuller Test\n\ndata:  rw\nDickey-Fuller = -1.5744, Lag order = 3, p-value = 0.7468\nalternative hypothesis: stationary\n```\n\n\n:::\n\n```{.r .cell-code}\nadf.test(diff(rw))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAugmented Dickey-Fuller Test\n\ndata:  diff(rw)\nDickey-Fuller = -4.2262, Lag order = 3, p-value = 0.01\nalternative hypothesis: stationary\n```\n\n\n:::\n:::\n\n\n\n\n\n## Model Selection: ARMA Subsets based on BIC\n\nSchwarz *Bayesian Information Criterion* (BIC)\n$$\nBIC = â€“ 2\\log(maximum likelihood) + k\\log(n)\n$$\nwhere $k$ is the number of parameters in the model and $n$ is the number of observations.\n\nMinimizing the BIC is equivalent to maximizing the likelihood of the model while penalizing for the number of parameters.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ARMA Subsets\nset.seed(92397)\nyt <- arima.sim(model=list(ar=c(rep(0,11),0.8),\n                            ma=c(rep(0,11),0.7)),n=120)\nres <- armasubsets(y=yt,nar=14,nma=14,\n                    y.name='yt',ar.method='ols')\nplot(res)\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the oil price data\ndata(oil.price)\n# Plot the oil price series\nacf(as.vector(diff(log(oil.price))),xaxp=c(0,22,11))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n```{.r .cell-code}\npacf(as.vector(diff(log(oil.price))),xaxp=c(0,22,11))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-13-2.png){width=672}\n:::\n:::\n\n\n\n\n## Random Walk\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Generate a random walk\nset.seed(439)\nz <- rnorm(60)\nrw <- ts(cumsum(z))\n# Plot the random walk\nplot(rw, main=\"Random Walk\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Unit root test of the random walk and its first difference\nadf.test(rw)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAugmented Dickey-Fuller Test\n\ndata:  rw\nDickey-Fuller = -1.5526, Lag order = 3, p-value = 0.7556\nalternative hypothesis: stationary\n```\n\n\n:::\n\n```{.r .cell-code}\nadf.test(diff(rw))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAugmented Dickey-Fuller Test\n\ndata:  diff(rw)\nDickey-Fuller = -3.3082, Lag order = 3, p-value = 0.079\nalternative hypothesis: stationary\n```\n\n\n:::\n\n```{.r .cell-code}\n# ACF, PACF of the Random Walk\nacf(rw, main=\"ACF of Random Walk\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-14-2.png){width=672}\n:::\n\n```{.r .cell-code}\npacf(rw, main=\"PACF of Random Walk\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-14-3.png){width=672}\n:::\n:::\n\n\n\n\nAfter differencing\n$$\nW_t=\\nabla Y_t = Y_t - Y_{t-1}.\n$$\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ACF, PACF of the differenced Random Walk\nacf(diff(rw), main=\"ACF of differenced Random Walk\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n```{.r .cell-code}\npacf(diff(rw), main=\"PACF of differenced Random Walk\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-15-2.png){width=672}\n:::\n:::\n\n\n\n\n## The Los Angeles Annual Rainfall Series\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the data\ndata(larain)\nplot(larain)\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Stabilize the variance\nqqnorm(log(larain),\n       main = \"Normal Q-Q Plot of log(larain)\") \nqqline(log(larain))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-16-2.png){width=672}\n:::\n:::\n\n\n\n\nDisplaying sample autocorrelations\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nacf(log(larain),\n    xaxp=c(0,20,10),\n    main = \"ACF of log(larain)\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n\n```{.r .cell-code}\nmean(log(larain))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2.593385\n```\n\n\n:::\n\n```{.r .cell-code}\nsd(log(larain))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.4774679\n```\n\n\n:::\n:::\n\n\n\n\n## The Chemical Process Color Property Series\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the data\ndata(color)\nplot(color)\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Plot ACF and PACF\nacf(color,ci.type='ma', lag.max=20, main=\"ACF of color\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-18-2.png){width=672}\n:::\n\n```{.r .cell-code}\npacf(color, lag.max=20, main=\"PACF of color\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-18-3.png){width=672}\n:::\n:::\n\n\n\n\n## The Annual Abundance of Canadian Hare Series\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the data\ndata(hare)\nplot(hare)\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Box-Cox transformation\nBoxCox.ar(hare)\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-19-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Plot ACF and PACF of the transformed series\nacf(hare^.5, main=\"ACF of hare^.5\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-19-3.png){width=672}\n:::\n\n```{.r .cell-code}\npacf(hare^.5, main=\"PACF of hare^.5\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-19-4.png){width=672}\n:::\n:::\n\n\n\n\n## The Oil Price Series\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tseries)\n# Load the data\ndata(\"oil.price\")\nplot(oil.price)\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Plot ACF and PACF\nacf(as.vector(oil.price),\n    xaxp=c(0,24,12),\n    main=\"ACF of oil.price\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-20-2.png){width=672}\n:::\n\n```{.r .cell-code}\npacf(as.vector(oil.price), \n    xaxp=c(0,24,12),\n    main=\"PACF of oil.price\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-20-3.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Log transformation\nplot(log(oil.price))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Differencing the log-transformed series\nplot(diff(log(oil.price)))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-21-2.png){width=672}\n:::\n\n```{.r .cell-code}\nacf(diff(as.vector(log(oil.price))),xaxp=c(0,24,12))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-21-3.png){width=672}\n:::\n\n```{.r .cell-code}\npacf(diff(as.vector(log(oil.price))),xaxp=c(0,24,12))\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-21-4.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# ADF test: to test for stationarity of log-transformed series\nadf.test(log(oil.price))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAugmented Dickey-Fuller Test\n\ndata:  log(oil.price)\nDickey-Fuller = -1.1119, Lag order = 6, p-value = 0.9189\nalternative hypothesis: stationary\n```\n\n\n:::\n\n```{.r .cell-code}\nadf.test(diff(log(oil.price)))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in adf.test(diff(log(oil.price))): p-value smaller than printed p-value\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tAugmented Dickey-Fuller Test\n\ndata:  diff(log(oil.price))\nDickey-Fuller = -6.6505, Lag order = 6, p-value = 0.01\nalternative hypothesis: stationary\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- armasubsets(y=diff(log(oil.price)),nar=7,nma=7,y.name='test', ar.method='ols')\nplot(res, main = \"ARMA Subsets\")\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture14-model-specification_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "TSA-Lecture14-model-specification_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}