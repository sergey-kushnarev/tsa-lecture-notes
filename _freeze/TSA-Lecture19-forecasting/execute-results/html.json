{
  "hash": "b8183d45957cce95f342e84e07dfc6f6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Rnotebook: Forecasting\"\nauthor: \"Dr Sergey Kushnarev\"\nformat:\n  html:\n    toc: true\n    number-sections: true\n    code-fold: true\n---\n\n\n\n\n## Steps in Time Series Analysis\n\n|   |   |   |   |\n|:---:|:---:|:---:|:---:|\n| Step 1: Model Specification |  Step 2: Parameter Estimation  | Step 3: Model Checking | **Step 4: Forecasting** |\n\n# ARIMA Forecasting\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(TSA)\n```\n:::\n\n\n\n\nBased on Chapter 9 Forecasting, Cryer and Chan (2008).\n\nForecasting is the process of predicting future values of a time series based on its past values. Let's introduce the notation for the time series and its forecast.\n\n- Let $Y_t$ be the time series at time $t$.\n- Let $Y_{t+1}, Y_{t+2}, \\ldots, Y_{t+h}$ be the future, yet unobserved, values of the time series for $h$ periods ahead.\n- The forecast for $Y_{t+1}$ is denoted as $\\hat{Y}_t(1)$ and is based on the information available up to time $t$. Similarly, $\\hat{Y}_t(2)$ is the forecast for $Y_{t+2}$ based on the information available up to time $t$, and so on.\n- The $h$-step-ahead forecast is denoted as $\\hat{Y}_t(h)$ and is based on the information available up to time $t$.\n- The forecast error for the $h$-step-ahead forecast is denoted as $e_t(h) = Y_{t+h} - \\hat{Y}_t(h)$.\n\n## Forecasting AR(1)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example of Forecasting AR(1) Model\ndata(ar1.s)\nm1.ar1=arima(ar1.s,order=c(1,0,0))\nplot(m1.ar1,n.ahead=12,type='b',\n        xlab='Time',ylab='AR(1)', \n        main = 'Forecasting AR(1) with 12 steps ahead, phi=0.9')\n# add the horizontal line at the estimated mean (\"intercept\")\nabline(h=coef(m1.ar1)[names(coef(m1.ar1))=='intercept'])\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture19-forecasting_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n\n## Forecasting AR(2)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example of Forecasting AR(2) Model\ndata(ar2.s)\nm1.ar2=arima(ar2.s,order=c(2,0,0))\nplot(m1.ar2,n.ahead=12,type='b',\n        xlab='Time',ylab='AR(2)', \n        main = 'Forecasting AR(2) with h=12 , phi1=1.5, phi2=-0.75')\n# add the horizontal line at the estimated mean (\"intercept\")\nabline(h=coef(m1.ar2)[names(coef(m1.ar2))=='intercept'])\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture19-forecasting_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\n## Forecasting MA(2)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example of Forecasting MA(2) Model\ndata(ma2.s)\nm1.ma2=arima(ma2.s,order=c(0,0,2))\nplot(m1.ma2,n.ahead=12,type='b',\n        xlab='Time',ylab='MA(2)', \n        main = 'Forecasting MA(2), h=12, theta1=1, theta2=-0.6')\n# add the horizontal line at the estimated mean (\"intercept\")\nabline(h=coef(m1.ma2)[names(coef(m1.ma2))=='intercept'])\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture19-forecasting_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n## Forecasting ARMA(1,1)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example of Forecasting ARMA(1,1) Model\ndata(arma11.s)\nm1.arma11=arima(arma11.s,order=c(1,0,1))\nplot(m1.arma11,n.ahead=12,type='b',\n        xlab='Time',ylab='ARMA(1,1)',\n        main = 'Forecasting ARMA(1,1), h=12, phi=0.6, theta=-0.3')\nabline(h=coef(m1.arma11)[names(coef(m1.arma11))=='intercept'])\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture19-forecasting_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n## Forecasting Random Walk with Drift\n\nRecall, random walk with a drift is defined as \n$$Y_t = Y_{t-1} + \\delta + e_t$$, \nwhere $e_t$ is a white noise error term and $\\delta$ is the drift parameter. The forecast for $\\hat{Y}_{t}(h)$ is given by $\\hat{Y}_t(h) = Y_t + h\\,\\delta$.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](TSA-Lecture19-forecasting_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n<!-- ```{r}\n# Comparing this to fable package\n#install.packages(\"tsibble\")\nlibrary(fable)\nlibrary(tsibble)\nlibrary(dplyr)\nlibrary(ggplot2)\n\n# Create a tsibble\ndf <- tibble(time = 1:100, value = x) %>% as_tsibble(index = time)\n\n# Fit a random walk with drift model\nfit <- df %>% model(rw = RW(value ~ drift()))\n\n# Forecast 12 steps ahead\nfc <- fit %>% forecast(h = 12)\n\n# Plot forecast with 95% prediction intervals\nautoplot(fc, df) +\n  ggtitle(\"Forecast from fable::RW with Observed Series\") +\n  ylab(\"Value\") +\n  xlab(\"Time\") +\n  theme_minimal()\n``` -->\n\n\n# Deterministic Trends\n\nA deterministic trend is a trend that can be predicted exactly using a mathematical function. For example, a linear trend can be represented by the equation $Y_t = \\beta_0 + \\beta_1 t + e_t$, where $e_t$ is a white noise error term.\nIn general, a deterministic trend can be represented by the equation \n$$\nY_t = \\mu_t + e_t,\n$$ \nwhere $\\mu_t$ is a deterministic function of time and $e_t$ is a white noise error term.\n\nThe forecasted value for $Y_{t+h}$ is given by $\\hat{Y}_t(h) = \\mu_{t+h}$.\nThe forecast error is given by $e_t(h) = Y_{t+h} - \\hat{Y}_t(h)=e_{t+h}$.\n\n<!-- \n::: {.cell}\n\n```{.r .cell-code}\ndata(tempdub)\ntempdub1=ts(c(tempdub,rep(NA,24)),\n                start=start(tempdub),\n                freq=frequency(tempdub))\nhar.<-harmonic(tempdub,1)\nm5.tempdub=arima(tempdub,order=c(0,0,0),xreg=har.)\nnewhar.=harmonic(ts(rep(1,24), start=c(1976,1),freq=12),1)\n# Compute and plot the forecasts.\nplot(m5.tempdub,n.ahead=24,n1=c(1972,1),\n        newxreg=newhar.,\n        type='b',ylab='Temperature',xlab='Year',\n        main ='Forecasts for Temperature')\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture19-forecasting_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n-->\n\n## Temperature Data\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Exhibit 9.2\n# append 2 years of missing values to the tempdub data as we want to forecast\n# the temperature for two years.\ndata(tempdub)\n\ntempdub1=ts(c(tempdub,rep(NA,24)),\n                start=start(tempdub),\n                freq=frequency(tempdub)) \n\n# creates the first pair of harmonic functions and then fit the model\nhar.=harmonic(tempdub,1)\nm5.tempdub=arima(tempdub,order=c(0,0,0),xreg=har.)\nm5.tempdub\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\narima(x = tempdub, order = c(0, 0, 0), xreg = har.)\n\nCoefficients:\n      intercept  cos(2*pi*t)  sin(2*pi*t)\n        46.2660     -26.7079      -2.1697\ns.e.     0.3056       0.4322       0.4322\n\nsigma^2 estimated as 13.45:  log likelihood = -391.44,  aic = 788.88\n```\n\n\n:::\n\n```{.r .cell-code}\n# create the harmonic functions over the period of forecast.\nnewhar.=harmonic(ts(rep(1,24), start=c(1976,1),freq=12),1)\n# Compute and plot the forecasts.\nplot(m5.tempdub,n.ahead=24,\n        n1=c(1972,1),newxreg=newhar.,\n        type='b',ylab='Temperature',xlab='Year')\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture19-forecasting_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\n# ARIMA Forecasting: actual time series\n\n## Color Property Data\n\nAR(1) model was fitted to the color property data. The forecast is based on the fitted AR(1) model and can be used to predict future values of the time series. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(color)\nm1.color=arima(color,order=c(1,0,0))\n\n# Exhibit 9.3 \ndata(color)\nm1.color=arima(color,order=c(1,0,0))\nplot(m1.color,n.ahead=12,type='b', xlab='Time', ylab='Color Property')\n# add the horizontal line at the estimated mean (\"intercept\") \nabline(h=coef(m1.color)[names(coef(m1.color))=='intercept'])\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture19-forecasting_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Hare Data\n\nThe Canadian hare abundance series was fitted by working with the square root of\nthe abundance numbers and then fitting an AR(3) model. Notice how the forecasts\nmimic the approximate cycle in the actual series even when we forecast with a lead time out to 25 years.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Exhibit 9.4\ndata(hare)\n# fixed the AR(2) coefficient to be 0 via the fixed argument.\nm1.hare=arima(sqrt(hare),order=c(3,0,0), fixed=c(NA,0,NA,NA)) \nplot(m1.hare, n.ahead=25,type='b',xlab='Year',ylab='Sqrt(hare)')\nabline(h=coef(m1.hare)[names(coef(m1.hare))=='intercept'])\n```\n\n::: {.cell-output-display}\n![](TSA-Lecture19-forecasting_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "TSA-Lecture19-forecasting_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}